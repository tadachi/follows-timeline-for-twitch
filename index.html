<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset="UTF-8">
    <meta content='text/html; charset=utf-8' http-equiv='content-type'>
    <title>.</title>
    <meta name='description' content='/'>
    <meta name='keywords' content=''>
    <meta name='author' content='takada'>

    <!-- CSS -->
    <link href="css/main.css" rel="stylesheet" type="text/css">
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <!-- Jquery -->
    <script src='js/jquery.min.js'></script>
    <!-- AngularJS -->
    <script src='js/angular.min.js'></script>
    <!-- Bootstrap -->
    <script src='js/bootstrap.min.js'></script>
    <!-- Misc JS Libs -->
    <script src='js/timeline-min.js'></script>
    <script src='js/storyjs-embed.js'></script>
    <!-- follows-timeline-for-twitch.js must come after AngularJS and JQuery -->
    <script src='js/follows-timeline-for-twitch.js'></script>
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-55847588-2', 'auto');
        ga('send', 'pageview');
    </script>

</head>
<script>
    /**
     * Similar to what you find in Java"s format.
     * Usage: chatsrc = "http://twitch.tv/chat/embed?channel={channel}&amp;popout_chat=true".format({ channel: streamer});
     */
    if (!String.prototype.format) {
        String.prototype.format = function() {
            var str = this.toString();
            if (!arguments.length)
                return str;
            var args = typeof arguments[0],
                    args = (("string" == args || "number" == args) ? arguments : arguments[0]);
            for (arg in args)
                str = str.replace(RegExp('\\{' + arg + '\\}', 'gi'), args[arg]);
            return str;
        }
    }

    var timeline_json = {
        "timeline":
        {
            "headline":"{username}'s Twitch Follows Timeline".format({username: "tak_ada"}),
            "type":"default",
            "text":"<p>Following {user_follow_count} People</p>".format({user_follow_count: 236}),
            "asset": {
                "media":"{user_logo}".format({user_logo: "http://static-cdn.jtvnw.net/jtv_user_pictures/tak_ada-profile_image-bbb30569f577053f-300x300.jpeg"}),
                "credit":"",
                "caption":"Account created on <b>{user_creation_date}</b>".format({user_creation_date: "2014-05-10"})
            },
            "date": [
                {
                    "startDate":"{stream_follow_date}".format({stream_follow_date: "2014,05,16"}),
                    "endDate":"{stream_follow_date}".format({stream_follow_date: "2014,05,16"}),
                    "headline":"{twitch_streamer_name}".format({twitch_streamer_name: "Nevuitz"}),
                    "text":"<b><a href=\"{stream_url}\">{stream_url}</a></b><br />Last Played: <b>{stream_last_played}</b><br />Follower Count: <b>{follower_count}</b>".format({stream_url: "http://www.twitch.tv/neviutz", stream_last_played: "Persona 3", follower_count: 3000}),
                    "tag":"", // This is optional.
                    "classname":"", // This is optional.
                    "asset": {
                        "media":"{stream_logo}".format({stream_logo: "http://static-cdn.jtvnw.net/jtv_user_pictures/neviutz-profile_image-e8d8940d205d8a19-300x300.jpeg"}),
                        "thumbnail":"{stream_logo}".format({stream_logo: "http://static-cdn.jtvnw.net/jtv_user_pictures/neviutz-profile_image-e8d8940d205d8a19-300x300.jpeg"}),
                        "credit":"Followed on <b>{stream_follow_date}</b>".format({stream_follow_date: "2014-05-10"}), // This is not needed.
                        "caption":"" // This is not needed.
                    }
                },
                {
                    "startDate":"{stream_follow_date}".format({stream_follow_date: "2014,05,17"}),
                    "endDate":"{stream_follow_date}".format({stream_follow_date: "2014,05,17"}),
                    "headline":"{twitch_streamer_name}".format({twitch_streamer_name: "Nevuitz"}),
                    "text":"<b><a href=\"{stream_url}\">{stream_url}</a></b><br />Last Played: <b>{stream_last_played}</b><br />Follower Count: <b>{follower_count}</b>".format({stream_url: "http://www.twitch.tv/neviutz", stream_last_played: "Persona 3", follower_count: 3000}),
                    "tag":"", // This is optional.
                    "classname":"", // This is optional.
                    "asset": {
                        "media":"{stream_logo}".format({stream_logo: "http://static-cdn.jtvnw.net/jtv_user_pictures/neviutz-profile_image-e8d8940d205d8a19-300x300.jpeg"}),
                        "thumbnail":"{stream_logo}".format({stream_logo: "http://static-cdn.jtvnw.net/jtv_user_pictures/neviutz-profile_image-e8d8940d205d8a19-300x300.jpeg"}),
                        "credit":"Followed on <b>{stream_follow_date}</b>".format({stream_follow_date: "2014-05-10"}), // This is not needed.
                        "caption":"" // This is not needed.
                    }
                }
            ]

        }
    };


    $(document).ready(function() {
        createStoryJS({
            type:       "timeline",
            width:      "1000",
            height:     "400",
            source:     timeline_json,
            embed_id:   "timeline-embed"
        });
    });

    var app = angular.module("App", []);
    app.controller("Ctrl", function($scope, $http) {
        $scope.url1 = "https://api.twitch.tv/kraken/channels/tak_ada/?callback=JSON_CALLBACK";
        $scope.url2 = "https://api.twitch.tv/kraken/users/tak_ada/follows/channels?direction=ASC&limit=1000&offset=0&sortby=created_at&callback=JSON_CALLBACK";

        $http.jsonp($scope.url1).
                success(function(data){
                    console.log(data);
                });
        $http.jsonp($scope.url2).
                success(function(data){
                    console.log(data);
                    var date = new Date(data.follows[0].created_at);
                    console.log(date.getFullYear());
                    console.log($scope.isoDateToTimelineDate(data.follows[0].created_at));
                });

        /**
         * input: "2014-05-16T08:01:41Z"
         * output: "2014,05,16"
         *
         * @param isoStringDate
         * @returns {string}
         */
        $scope.isoDateToTimelineDate = function(isoStringDate) {
            tempDate = new Date(isoStringDate);
            return tempDate.getFullYear() + "," + tempDate.getMonth() + "," + tempDate.getDay();
        };

        /**
         * Example inputs:
         * url1: "https://api.twitch.tv/kraken/channels/tak_ada/?callback=JSON_CALLBACK"
         * ir;2: "https://api.twitch.tv/kraken/users/tak_ada/follows/channels?direction=ASC&limit=1000&offset=0&sortby=created_at&callback=JSON_CALLBACK"
         *
         * @param url1
         * @param url2
         */
        $scope.twitchJsonToTimelineJson = function(url1, url2) {

        };
    });


</script>
<body>
    <div ng-app="App">
        <div ng-controller="Ctrl">
        </div>
    </div>
    <div id="timeline-embed"></div>

</body>

</html>